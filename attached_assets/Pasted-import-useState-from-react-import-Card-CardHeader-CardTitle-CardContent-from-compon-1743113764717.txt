import { useState } from "react";
import { Card, CardHeader, CardTitle, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Textarea } from "@/components/ui/textarea";
import { Label } from "@/components/ui/label";

interface DiagnosisFeedbackUIProps {
  patientId: string;
  diagnosisOptions: { label: string; confidence: number; reasoning: string }[];
  onSubmit: (selected: string, feedback: string) => void;
  onRequestMoreInfo?: () => void;
}

export default function DiagnosisFeedbackUI({
  patientId,
  diagnosisOptions,
  onSubmit,
  onRequestMoreInfo,
}: DiagnosisFeedbackUIProps) {
  const [selected, setSelected] = useState<string>("");
  const [feedback, setFeedback] = useState<string>("");

  return (
    <Card className="p-4 space-y-4">
      <CardHeader>
        <CardTitle>AI Diagnosis Feedback</CardTitle>
        <p className="text-sm text-muted-foreground">
          Please review the suggested diagnoses and select the most accurate one.
        </p>
      </CardHeader>
      <CardContent className="space-y-4">
        {diagnosisOptions.map((diag, i) => (
          <div
            key={i}
            className={`border p-3 rounded-md cursor-pointer transition-all ${
              selected === diag.label
                ? "border-green-500 bg-green-50"
                : "border-gray-300"
            }`}
            onClick={() => setSelected(diag.label)}
          >
            <p className="font-semibold">{diag.label}</p>
            <p className="text-sm">Confidence: {diag.confidence}%</p>
            <p className="text-xs text-gray-500 mt-1">Reasoning: {diag.reasoning}</p>
          </div>
        ))}

        <div className="space-y-2">
          <Label htmlFor="feedback">Doctor Feedback (Optional)</Label>
          <Textarea
            id="feedback"
            placeholder="Write your feedback or suggestions here..."
            value={feedback}
            onChange={(e) => setFeedback(e.target.value)}
          />
        </div>

        <div className="flex gap-2 justify-between">
          {onRequestMoreInfo && (
            <Button
              variant="outline"
              onClick={onRequestMoreInfo}
              className="text-yellow-600 border-yellow-600 hover:bg-yellow-50"
            >
              Ask AI for More Info
            </Button>
          )}
          <Button
            onClick={() => onSubmit(selected, feedback)}
            disabled={!selected}
          >
            Submit Feedback
          </Button>
        </div>
      </CardContent>
    </Card>
  );
}