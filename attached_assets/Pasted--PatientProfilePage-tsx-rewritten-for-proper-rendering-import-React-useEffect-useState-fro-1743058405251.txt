// PatientProfilePage.tsx (rewritten for proper rendering)
import React, { useEffect, useState } from "react";
import { useParams } from "react-router-dom";
import { Tabs, TabsList, TabsTrigger, TabsContent } from "@/components/ui/tabs";
import { getPatientDetails } from "@/lib/api";
import PatientOverview from "@/components/patients/PatientOverview";
import MedicalHistory from "@/components/patients/MedicalHistory";
import RestorativeChart from "@/components/patients/RestorativeChart";
import PerioChart from "@/components/patients/PerioChart";
import XrayGallery from "@/components/patients/XrayGallery";
import AIHub from "@/components/patients/AIHub";
import ScheduleView from "@/components/patients/ScheduleView";
import FinancialSummary from "@/components/patients/FinancialSummary";
import PatientNotes from "@/components/patients/PatientNotes";

const PatientProfilePage = () => {
  const { id } = useParams();
  const [patient, setPatient] = useState(null);

  useEffect(() => {
    const fetchData = async () => {
      const data = await getPatientDetails(id);
      setPatient(data);
    };
    fetchData();
  }, [id]);

  if (!patient) return <div className="p-4 text-center">Loading patient data...</div>;

  return (
    <div className="p-6">
      <PatientOverview data={patient} />
      <Tabs defaultValue="medical" className="mt-6">
        <TabsList>
          <TabsTrigger value="medical">Medical History</TabsTrigger>
          <TabsTrigger value="restorative">Restorative Chart</TabsTrigger>
          <TabsTrigger value="perio">Perio Chart</TabsTrigger>
          <TabsTrigger value="xrays">X-Rays</TabsTrigger>
          <TabsTrigger value="ai">AI Diagnosis</TabsTrigger>
          <TabsTrigger value="schedule">Appointments</TabsTrigger>
          <TabsTrigger value="financial">Finances</TabsTrigger>
          <TabsTrigger value="notes">Patient Notes</TabsTrigger>
        </TabsList>

        <TabsContent value="medical">
          <MedicalHistory data={patient.medicalHistory} />
        </TabsContent>
        <TabsContent value="restorative">
          <RestorativeChart data={patient.restorativeChart} />
        </TabsContent>
        <TabsContent value="perio">
          <PerioChart data={patient.perioChart} />
        </TabsContent>
        <TabsContent value="xrays">
          <XrayGallery xrays={patient.xrays} />
        </TabsContent>
        <TabsContent value="ai">
          <AIHub patientId={patient.id} />
        </TabsContent>
        <TabsContent value="schedule">
          <ScheduleView appointments={patient.appointments} />
        </TabsContent>
        <TabsContent value="financial">
          <FinancialSummary billing={patient.billing} insurance={patient.insurance} />
        </TabsContent>
        <TabsContent value="notes">
          <PatientNotes patientId={patient.id} />
        </TabsContent>
      </Tabs>
    </div>
  );
};

export default PatientProfilePage;