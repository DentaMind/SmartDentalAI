import { useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Textarea } from "@/components/ui/textarea";

interface DiagnosisOption {
  diagnosis: string;
  reasoning: string;
  confidence: number;
}

interface DiagnosisFeedbackUIProps {
  patientId: string;
  aiDiagnosisOptions: DiagnosisOption[];
  onSubmitFeedback: (selectedDiagnosis: string, feedback: string) => void;
  onRequestMoreInfo?: () => void;
}

export default function DiagnosisFeedbackUI({
  patientId,
  aiDiagnosisOptions,
  onSubmitFeedback,
  onRequestMoreInfo,
}: DiagnosisFeedbackUIProps) {
  const [selectedDiagnosis, setSelectedDiagnosis] = useState<string>("");
  const [feedback, setFeedback] = useState<string>("");

  const handleSubmit = () => {
    if (selectedDiagnosis) {
      onSubmitFeedback(selectedDiagnosis, feedback);
    }
  };

  return (
    <div className="space-y-4">
      <h2 className="text-xl font-semibold">AI Diagnosis Options</h2>
      {aiDiagnosisOptions.map((option, index) => (
        <Card
          key={index}
          className={`cursor-pointer border-2 transition-all ${
            selectedDiagnosis === option.diagnosis
              ? "border-green-500 shadow-md"
              : "border-gray-300"
          }`}
          onClick={() => setSelectedDiagnosis(option.diagnosis)}
        >
          <CardContent className="space-y-2 p-4">
            <p className="font-bold">Diagnosis: {option.diagnosis}</p>
            <p className="text-sm text-gray-600">Reasoning: {option.reasoning}</p>
            <p className="text-sm text-gray-500">Confidence: {option.confidence}%</p>
          </CardContent>
        </Card>
      ))}

      <div className="space-y-2">
        <Textarea
          placeholder="Optional feedback for AI (e.g., why you chose a certain diagnosis or what it missed)"
          value={feedback}
          onChange={(e) => setFeedback(e.target.value)}
        />
        <div className="flex space-x-2">
          <Button onClick={handleSubmit} disabled={!selectedDiagnosis}>
            Submit Diagnosis
          </Button>
          {onRequestMoreInfo && (
            <Button variant="outline" onClick={onRequestMoreInfo}>
              Ask AI for More Info
            </Button>
          )}
        </div>
      </div>
    </div>
  );
}